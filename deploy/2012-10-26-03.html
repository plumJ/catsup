<!DOCTYPE html>
<html>
<html xmlns:wb="http://open.weibo.com/wb">
<head>
<script src="http://tjs.sjs.sinajs.cn/open/api/js/wb.js?appkey=" type="text/javascript" charset="utf-8"></script>
<meta name="baidu-site-verification" content="sLC4D5A7TJnZzVQK" />
<meta name="google-site-verification" content="rKFkFJFqy-8_UJHs8SerP3L1_SWoFgwrFZ53BngASKM" />
<meta property="wb:webmaster" content="12245f3efdaccda8" />
<meta charset="utf-8">

<meta name="description" content="使用urlopen.read()判断url状态并反馈,python,urllib2,">
<meta name="keywords" content="python,urllib2,">

<title>
使用urlopen.read()判断url状态并反馈 | plum.J
</title>
<link href='http://fonts.googleapis.com/css?family=Abel' rel='stylesheet' type='text/css'>
<link rel="stylesheet" href="static/css/style.css?20120722" type="text/css" />
<link rel="stylesheet" href="static/css/pygments_style.css" type="text/css" />
<link rel="alternate" type="application/rss+xml" href="feed.xml" title="plum.J" />

</head>
<body>
<div id="header">
<div id="nav_wrapper">
<div id="nav">
<div class="inner">
<h1 id="title"><a href="http://plumj.com">plum.J</a></h1>
<div id="description" class="seal">'s blog</div>
<ul class="right">

<li><a href="tag_cms-gc.html">Cms-gc</a></li>
<li class="dot">&bull;</li>

<li><a href="tag_tomcat.html">Tomcat</a></li>
<li class="dot">&bull;</li>

<li><a href="tag_catsup.html">Catsup</a></li>
<li class="dot">&bull;</li>

<li><a href="tag_python.html">Python</a></li>
<li class="dot">&bull;</li>

<li><a href="tag_urllib2.html">Urllib2</a></li>
<li class="dot">&bull;</li>

</ul>
</div>
</div>
</div>
<div id="header_inner">
<div id="social">

<a href="http://twitter.com/_plumJ" target="_blank" title="Follow Me @ Twitter"><img src="static/image/ic16_twitter.png"></a>


<a href="http://github.com/plumJ" target="_blank" title="Fork Me @ Github"><img src="static/image/ic16_github.png"></a>

<a href="feed.xml" target="_blank" title="Subscribe My Blog"><img src="static/image/ic16_rss.png"></a>
</div>
<div class="sep"></div>
</div>
</div>
<div id="content">

<div class="article">
<div class="inner">
<h2 class="article_title title"><a href="#">使用urlopen.read()判断url状态并反馈</a></h2>
<div class="article_meta">
<div class="share">
<a href="https://twitter.com/share" class="twitter-share-button" data-via="_plumJ" data-lang="zh-cn">Twitter</a>
</div>
<span>on</span>
2012-10-26
</div>
<div class="text">
<h4>Source Code</h4>
<div class="highlight"><pre><span class="c">#!/usr/bin/env python</span>

<span class="kn">import</span> <span class="nn">os</span>

<span class="kn">import</span> <span class="nn">time</span>

<span class="kn">import</span> <span class="nn">urllib2</span>

<span class="kn">import</span> <span class="nn">telnetlib</span>

<span class="kn">import</span> <span class="nn">socket</span>



<span class="n">socket</span><span class="o">.</span><span class="n">setdefaulttimeout</span><span class="p">(</span><span class="mf">10.0</span><span class="p">)</span>



<span class="n">expectTime</span> <span class="o">=</span> <span class="mi">5</span> <span class="c"># seconds</span>

<span class="n">host</span> <span class="o">=</span> <span class="s">&quot;127.0.0.1&quot;</span>

<span class="n">port</span> <span class="o">=</span> <span class="s">&quot;80&quot;</span>

<span class="n">tomcat</span> <span class="o">=</span> <span class="s">&quot;/usr/local/tomcat/&quot;</span>



<span class="k">def</span> <span class="nf">restartlocaltomcat</span><span class="p">():</span>

    <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s">&quot;mv /var/log/tomcat_gc.log /var/log/tomcat_gc.log.`date +%Y%m</span><span class="si">%d</span><span class="s">`&quot;</span><span class="p">)</span>

    <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s">&#39;echo &quot;[`date`] Tomcat now to shutdowning, please wait 10 seconds ..&quot; &gt;&gt; tomcatstatus.log&#39;</span><span class="p">)</span>

    <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="n">tomcat</span> <span class="o">+</span> <span class="s">&quot;bin/shutdown.sh&quot;</span><span class="p">)</span>

    <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s">&quot;kill -9 `ps -C java --no-header | awk &#39;{print $1}&#39;`&quot;</span><span class="p">)</span>

    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>

        <span class="n">tel</span> <span class="o">=</span> <span class="n">telnetlib</span><span class="o">.</span><span class="n">Telnet</span><span class="p">(</span><span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="p">)</span>

        <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s">&#39;echo &quot;[`date`] Shutdown tomcat failed, please shutdown by yourself ..&quot; &gt;&gt; tomcatstatus.log&#39;</span><span class="p">)</span>

    <span class="k">except</span><span class="p">:</span>

        <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s">&#39;echo &quot;[`date`] Shutdown tomcat success ..&quot; &gt;&gt; tomcatstatus.log&#39;</span><span class="p">)</span>

        <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s">&#39;echo &quot;[`date`] Tomcat now to starting ..&quot; &gt;&gt; tomcatstatus.log&#39;</span><span class="p">)</span>

        <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="n">tomcat</span> <span class="o">+</span> <span class="s">&quot;bin/startup.sh&quot;</span><span class="p">)</span>

        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">60</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>

            <span class="n">telnet</span> <span class="o">=</span> <span class="n">telnetlib</span><span class="o">.</span><span class="n">Telnet</span><span class="p">(</span><span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="p">)</span>

            <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s">&#39;echo &quot;[`date`] Startup tomcat success ..&quot; &gt;&gt; tomcatstatus.log&#39;</span><span class="p">)</span>

        <span class="k">except</span><span class="p">:</span>

            <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s">&#39;echo &quot;[`date`] Startup tomcat failed ..&quot; &gt;&gt; tomcatstatus.log&#39;</span><span class="p">)</span>



<span class="k">while</span><span class="p">(</span><span class="bp">True</span><span class="p">):</span>

    <span class="k">try</span><span class="p">:</span>

        <span class="n">startTime</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

        <span class="c">#urllib2.urlopen(&quot;http://192.168.10.50/index.html&quot;).read()</span>

        <span class="n">urllib2</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="s">&quot;http://192.168.10.50/search?q=&amp;sort=0&amp;pageSize=4&amp;isQueryTerm=0&amp;sourceId=item.index&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

        <span class="n">endTime</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

    <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>

        <span class="n">restartlocaltomcat</span><span class="p">()</span>

        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="o">*</span><span class="mi">60</span><span class="p">)</span>

        <span class="k">continue</span>

    <span class="k">if</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">endTime</span> <span class="o">-</span> <span class="n">startTime</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">expectTime</span><span class="p">):</span>

        <span class="n">restartlocaltomcat</span><span class="p">()</span>

    <span class="c">#else:</span>

    <span class="c">#   os.system(&#39;echo &quot;[`date`] Tomcat status OK&quot; &gt;&gt; tomcatstatus.log&#39;)</span>

    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="o">*</span><span class="mi">60</span><span class="p">)</span>
</pre></div>

<h4>How to use</h4>
<div class="highlight"><pre><span class="o">[</span>root@vh1 ~<span class="o">]</span><span class="c"># nohup python checkUrlTomcat.py &amp;</span>
</pre></div>

</div>

<div class="big_sep"></div>
<div class="article_meta">
<span>tagged:</span>

<a class="tag" href="tag_python.html">python</a>

<a class="tag" href="tag_urllib2.html">urllib2</a>

</div>

<div class="big_sep"></div>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
<div id="disqus_thread"></div>
<script type="text/javascript">
(function() {
var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
dsq.src = 'http://catsup.disqus.com/embed.js';
(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>
</div>
</div>


<a id="next" href="2012-10-26-02.html" class="v_nav" >
<span class="icon">Next</span>
</a>


</div>
<div id="footer_wrapper">
<div id="footer">
<div id="footer_inner">
<div class="tag_cloud col">
<h2>Tag Cloud</h2>

<a class="tag" href="tag_cms-gc.html">Cms-gc (1)</a>

<a class="tag" href="tag_tomcat.html">Tomcat (1)</a>

<a class="tag" href="tag_catsup.html">Catsup (1)</a>

<a class="tag" href="tag_python.html">Python (1)</a>

<a class="tag" href="tag_urllib2.html">Urllib2 (1)</a>

<a class="tag" href="tag_lucene.html">Lucene (1)</a>

<a class="tag" href="tag_nginx.html">Nginx (1)</a>

<a class="tag" href="tag_jvm.html">Jvm (1)</a>

<a class="tag" href="tag_urlrewrite.html">Urlrewrite (1)</a>

</div>
<div class="col">
<h2>Archives</h2>
<ul>

<li><a href="archive_2012.html">2012 (3)</a></li>

</ul>
</div>
<div class="col">
<h2>Links</h2>
<ul>

<li><a href="http://whouz.com" title="whouz write catsup" target="_blank">whtsky</a></li>

<li><a href="https://github.com/whtsky/catsup" title="the source of this blog" target="_blank">catsup</a></li>

</ul>
</div>
<div class="copyright">
Powered by <a href="https://github.com/whtsky/catsup">CATSUP</a>
<span>&bull;</span>
SealScript Theme by <a href="http://shellex.info">Shellex</a>
<span>&bull;</span>
Hosted on <a href="https://whmcs.hangssh.info/aff.php?aff=144">Host700</a>
<span>&bull;</span>
<a target="_blank" href="http://sighttp.qq.com/authd?IDKEY=cf54edfcbb086c98745cfe1a9eb2d7a8b8249f1c48135f26"><img border="0" src="http://wpa.qq.com/imgd?IDKEY=cf54edfcbb086c98745cfe1a9eb2d7a8b8249f1c48135f26&pic=45" alt="点击这里给我发消息" title="点击这里给我发消息"></a>
</div>
</div>
</div>
</div>
</body>
</html>
