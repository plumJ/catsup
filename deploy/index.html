<!DOCTYPE html>
<html>
<html xmlns:wb="http://open.weibo.com/wb">
<head>
<script src="http://tjs.sjs.sinajs.cn/open/api/js/wb.js?appkey=" type="text/javascript" charset="utf-8"></script>
<meta name="baidu-site-verification" content="9AqcZEpfELTobr3o" />
<meta name="google-site-verification" content="rKFkFJFqy-8_UJHs8SerP3L1_SWoFgwrFZ53BngASKM" />
<meta property="wb:webmaster" content="12245f3efdaccda8" />
<meta charset="utf-8">

<title>plum.J</title>
<link href='http://fonts.googleapis.com/css?family=Abel' rel='stylesheet' type='text/css'>
<link rel="stylesheet" href="static/css/style.css?20120722" type="text/css" />
<link rel="stylesheet" href="static/css/pygments_style.css" type="text/css" />
<link rel="alternate" type="application/rss+xml" href="feed.xml" title="plum.J" />

</head>
<body>
<div id="header">
<div id="nav_wrapper">
<div id="nav">
<div class="inner">
<h1 id="title"><a href="http://plumj.com">plum.J</a></h1>
<div id="description" class="seal">'s blog</div>
<ul class="right">

<li><a href="tag_tomcat.html">Tomcat</a></li>
<li class="dot">&bull;</li>

<li><a href="tag_python.html">Python</a></li>
<li class="dot">&bull;</li>

<li><a href="tag_nginx.html">Nginx</a></li>
<li class="dot">&bull;</li>

<li><a href="tag_jvm.html">Jvm</a></li>
<li class="dot">&bull;</li>

<li><a href="tag_catsup.html">Catsup</a></li>
<li class="dot">&bull;</li>

</ul>
</div>
</div>
</div>
<div id="header_inner">
<div id="social">

<a href="http://twitter.com/_plumJ" target="_blank" title="Follow Me @ Twitter"><img src="static/image/ic16_twitter.png"></a>


<a href="http://github.com/plumJ" target="_blank" title="Fork Me @ Github"><img src="static/image/ic16_github.png"></a>

<a href="feed.xml" target="_blank" title="Subscribe My Blog"><img src="static/image/ic16_rss.png"></a>
</div>
<div class="sep"></div>
</div>
</div>
<div id="content">

<ul id="article_list">

<li class="list_item">
<div class="article">
<div class="inner">
<h2 class="article_title title"><a href="2012-10-26-python.html">检测URL并自动处理脚本</a></h2>
<div class="article_meta">
<span>on</span>
2012-10-26
</div>
<div class="text">
<h4>源码</h4>
<div class="highlight"><pre><span class="c">#!/usr/bin/env python</span>

<span class="kn">import</span> <span class="nn">os</span>

<span class="kn">import</span> <span class="nn">time</span>

<span class="kn">import</span> <span class="nn">urllib2</span>

<span class="kn">import</span> <span class="nn">telnetlib</span>

<span class="kn">import</span> <span class="nn">socket</span>



<span class="n">socket</span><span class="o">.</span><span class="n">setdefaulttimeout</span><span class="p">(</span><span class="mf">10.0</span><span class="p">)</span>



<span class="n">expectTime</span> <span class="o">=</span> <span class="mi">5</span> <span class="c"># seconds</span>

<span class="n">host</span> <span class="o">=</span> <span class="s">&quot;127.0.0.1&quot;</span>

<span class="n">port</span> <span class="o">=</span> <span class="s">&quot;80&quot;</span>

<span class="n">tomcat</span> <span class="o">=</span> <span class="s">&quot;/usr/local/tomcat/&quot;</span>



<span class="k">def</span> <span class="nf">restartlocaltomcat</span><span class="p">():</span>

    <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s">&quot;mv /var/log/tomcat_gc.log /var/log/tomcat_gc.log.`date +%Y%m</span><span class="si">%d</span><span class="s">`&quot;</span><span class="p">)</span>

    <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s">&#39;echo &quot;[`date`] Tomcat now to shutdowning, please wait 10 seconds ..&quot; &gt;&gt; tomcatstatus.log&#39;</span><span class="p">)</span>

    <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="n">tomcat</span> <span class="o">+</span> <span class="s">&quot;bin/shutdown.sh&quot;</span><span class="p">)</span>

    <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s">&quot;kill -9 `ps -C java --no-header | awk &#39;{print $1}&#39;`&quot;</span><span class="p">)</span>

    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>

        <span class="n">tel</span> <span class="o">=</span> <span class="n">telnetlib</span><span class="o">.</span><span class="n">Telnet</span><span class="p">(</span><span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="p">)</span>

        <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s">&#39;echo &quot;[`date`] Shutdown tomcat failed, please shutdown by yourself ..&quot; &gt;&gt; tomcatstatus.log&#39;</span><span class="p">)</span>

    <span class="k">except</span><span class="p">:</span>

        <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s">&#39;echo &quot;[`date`] Shutdown tomcat success ..&quot; &gt;&gt; tomcatstatus.log&#39;</span><span class="p">)</span>

        <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s">&#39;echo &quot;[`date`] Tomcat now to starting ..&quot; &gt;&gt; tomcatstatus.log&#39;</span><span class="p">)</span>

        <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="n">tomcat</span> <span class="o">+</span> <span class="s">&quot;bin/startup.sh&quot;</span><span class="p">)</span>

        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">60</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>

            <span class="n">telnet</span> <span class="o">=</span> <span class="n">telnetlib</span><span class="o">.</span><span class="n">Telnet</span><span class="p">(</span><span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="p">)</span>

            <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s">&#39;echo &quot;[`date`] Startup tomcat success ..&quot; &gt;&gt; tomcatstatus.log&#39;</span><span class="p">)</span>

        <span class="k">except</span><span class="p">:</span>

            <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s">&#39;echo &quot;[`date`] Startup tomcat failed ..&quot; &gt;&gt; tomcatstatus.log&#39;</span><span class="p">)</span>



<span class="k">while</span><span class="p">(</span><span class="bp">True</span><span class="p">):</span>

    <span class="k">try</span><span class="p">:</span>

        <span class="n">startTime</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

        <span class="c">#urllib2.urlopen(&quot;http://192.168.10.50/index.html&quot;).read()</span>

        <span class="n">urllib2</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="s">&quot;http://192.168.10.50/search?q=&amp;sort=0&amp;pageSize=4&amp;isQueryTerm=0&amp;sourceId=item.index&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

        <span class="n">endTime</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

    <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>

        <span class="n">restartlocaltomcat</span><span class="p">()</span>

        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="o">*</span><span class="mi">60</span><span class="p">)</span>

        <span class="k">continue</span>

    <span class="k">if</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">endTime</span> <span class="o">-</span> <span class="n">startTime</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">expectTime</span><span class="p">):</span>

        <span class="n">restartlocaltomcat</span><span class="p">()</span>

    <span class="c">#else:</span>

    <span class="c">#   os.system(&#39;echo &quot;[`date`] Tomcat status OK&quot; &gt;&gt; tomcatstatus.log&#39;)</span>

    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="o">*</span><span class="mi">60</span><span class="p">)</span>
</pre></div>

<h4>如何使用 How to use</h4>
<div class="highlight"><pre>nohup python checkUrlTomcat.py &amp;
</pre></div>

</div>
<div class="article_meta">
<span>tagged:</span>

<a class="tag" href="tag_python.html">python</a>

<a class="tag" href="tag_tomcat.html">tomcat</a>

</div>
</div>
</div>
<div class="sep"></div>
</li>

<li class="list_item">
<div class="article">
<div class="inner">
<h2 class="article_title title"><a href="2012-10-26-nginx.html">Nginx纯静态化配置 on catsup</a></h2>
<div class="article_meta">
<span>on</span>
2012-10-26
</div>
<div class="text">
<h4>当前配置:</h4>
<div class="highlight"><pre>server {

    listen 80;

    server_name  plumj.com;

    root /usr/local/catsup/deploy;



    add_header     Nginx-Cache     &quot;HIT from plumj.com&quot;;

    add_header     Vary            Accept-Encoding;



    if ($host != &#39;plumj.com&#39;) {

        rewrite ^/(.*)$ http://plumj.com/$1 permanent;

    }



    location ~^/static/ {

            expires 2d;

    }

}
</pre></div>

</div>
<div class="article_meta">
<span>tagged:</span>

<a class="tag" href="tag_nginx.html">nginx</a>

<a class="tag" href="tag_catsup.html">catsup</a>

</div>
</div>
</div>
<div class="sep"></div>
</li>

<li class="list_item">
<div class="article">
<div class="inner">
<h2 class="article_title title"><a href="2012-10-26-jvm.html">JVM优化</a></h2>
<div class="article_meta">
<span>on</span>
2012-10-26
</div>
<div class="text">
<h4>优化配置段</h4>
<div class="highlight"><pre><span class="nv">JAVA_OPTS</span><span class="o">=</span><span class="s2">&quot;</span>

<span class="s2">-server -Xms3g -Xmx3g -Xmn800m  -XX:PermSize=256m -XX:MaxPermSize=256m -Xnoclassgc -XX:+DisableExplicitGC</span>

<span class="s2">-XX:SurvivorRatio=65536 -XX:MaxTenuringThreshold=0</span>

<span class="s2">-XX:+UseParNewGC</span>

<span class="s2">-XX:+UseConcMarkSweepGC</span>

<span class="s2">-XX:+CMSParallelRemarkEnabled</span>

<span class="s2">-XX:+UseCMSCompactAtFullCollection</span>

<span class="s2">-XX:CMSFullGCsBeforeCompaction=0</span>

<span class="s2">-XX:+UseCMSInitiatingOccupancyOnly</span>

<span class="s2">-XX:CMSInitiatingOccupancyFraction=55</span>

<span class="s2">-XX:+CMSClassUnloadingEnabled</span>



<span class="s2">-XX:+PrintClassHistogram</span>

<span class="s2">-XX:+PrintGCTimeStamps</span>

<span class="s2">-XX:+PrintHeapAtGC</span>

<span class="s2">-XX:+PrintGCApplicationStoppedTime</span>

<span class="s2">-XX:+PrintGCDetails</span>

<span class="s2">-Xloggc:&#39;/var/log/tomcat_gc.log&#39;</span>

<span class="s2">&quot;</span>
</pre></div>

<h4>优化效果，以下是GClog日志</h4>
<div class="highlight"><pre>36673.582: <span class="o">[</span>GC <span class="o">[</span>1 CMS-initial-mark: 1280228K<span class="o">(</span>2326528K<span class="o">)]</span> 1282461K<span class="o">(</span>3145664K<span class="o">)</span>, 0.0020900 secs<span class="o">]</span> <span class="o">[</span>Times: <span class="nv">user</span><span class="o">=</span>0.01 <span class="nv">sys</span><span class="o">=</span>0.00, <span class="nv">real</span><span class="o">=</span>0.00 secs<span class="o">]</span> 

36673.584: <span class="o">[</span>CMS-concurrent-mark-start<span class="o">]</span>

36673.904: <span class="o">[</span>CMS-concurrent-mark: 0.320/0.320 secs<span class="o">]</span> <span class="o">[</span>Times: <span class="nv">user</span><span class="o">=</span>0.88 <span class="nv">sys</span><span class="o">=</span>0.00, <span class="nv">real</span><span class="o">=</span>0.32 secs<span class="o">]</span> 

36673.904: <span class="o">[</span>CMS-concurrent-preclean-start<span class="o">]</span>

36673.921: <span class="o">[</span>CMS-concurrent-preclean: 0.016/0.016 secs<span class="o">]</span> <span class="o">[</span>Times: <span class="nv">user</span><span class="o">=</span>0.04 <span class="nv">sys</span><span class="o">=</span>0.00, <span class="nv">real</span><span class="o">=</span>0.02 secs<span class="o">]</span> 

36673.921: <span class="o">[</span>CMS-concurrent-abortable-preclean-start<span class="o">]</span>

36675.839: <span class="o">[</span>CMS-concurrent-abortable-preclean: 0.348/1.919 secs<span class="o">]</span> <span class="o">[</span>Times: <span class="nv">user</span><span class="o">=</span>2.63 <span class="nv">sys</span><span class="o">=</span>0.19, <span class="nv">real</span><span class="o">=</span>1.92 secs<span class="o">]</span> 

36675.840: <span class="o">[</span>GC<span class="o">[</span>YG occupancy: 461341 K <span class="o">(</span>819136 K<span class="o">)]</span>36675.840: <span class="o">[</span>Rescan <span class="o">(</span>parallel<span class="o">)</span> , 0.2238640 secs<span class="o">]</span>36676.064: <span class="o">[</span>weak refs processing, 0.0055360 secs<span class="o">]</span>36676.069: <span class="o">[</span>class unloading, 0.0077180 secs<span class="o">]</span>36676.077: <span class="o">[</span>scrub symbol &amp; string tables, 0.0051810 secs<span class="o">]</span> <span class="o">[</span>1 CMS-remark: 1282623K<span class="o">(</span>2326528K<span class="o">)]</span> 1743964K<span class="o">(</span>3145664K<span class="o">)</span>, 0.2490560 secs<span class="o">]</span> <span class="o">[</span>Times: <span class="nv">user</span><span class="o">=</span>1.58 <span class="nv">sys</span><span class="o">=</span>0.00, <span class="nv">real</span><span class="o">=</span>0.25 secs<span class="o">]</span> 

36676.090: <span class="o">[</span>CMS-concurrent-sweep-start<span class="o">]</span>

36679.691: <span class="o">[</span>CMS-concurrent-sweep: 3.535/3.601 secs<span class="o">]</span> <span class="o">[</span>Times: <span class="nv">user</span><span class="o">=</span>6.61 <span class="nv">sys</span><span class="o">=</span>0.08, <span class="nv">real</span><span class="o">=</span>3.60 secs<span class="o">]</span> 

36679.691: <span class="o">[</span>CMS-concurrent-reset-start<span class="o">]</span>

36679.698: <span class="o">[</span>CMS-concurrent-reset: 0.007/0.007 secs<span class="o">]</span> <span class="o">[</span>Times: <span class="nv">user</span><span class="o">=</span>0.02 <span class="nv">sys</span><span class="o">=</span>0.00, <span class="nv">real</span><span class="o">=</span>0.01 secs<span class="o">]</span>
</pre></div>

<h4>优化所对应的项目</h4>

<p>Apache Lucene, A flagship sub-project, provides Java-based indexing and search technology.</p>

</div>
<div class="article_meta">
<span>tagged:</span>

<a class="tag" href="tag_jvm.html">jvm</a>

<a class="tag" href="tag_tomcat.html">tomcat</a>

</div>
</div>
</div>
<div class="sep"></div>
</li>

</ul>



</div>
<div id="footer_wrapper">
<div id="footer">
<div id="footer_inner">
<div class="tag_cloud col">
<h2>Tag Cloud</h2>

<a class="tag" href="tag_tomcat.html">Tomcat (2)</a>

<a class="tag" href="tag_python.html">Python (1)</a>

<a class="tag" href="tag_nginx.html">Nginx (1)</a>

<a class="tag" href="tag_jvm.html">Jvm (1)</a>

<a class="tag" href="tag_catsup.html">Catsup (1)</a>

</div>
<div class="col">
<h2>Archives</h2>
<ul>

<li><a href="archive_2012.html">2012 (3)</a></li>

</ul>
</div>
<div class="col">
<h2>Links</h2>
<ul>

<li><a href="http://whouz.com" title="whouz write catsup" target="_blank">whtsky</a></li>

<li><a href="https://github.com/whtsky/catsup" title="the source of this blog" target="_blank">catsup</a></li>

</ul>
</div>
<div class="copyright">
Powered by <a href="https://github.com/whtsky/catsup">CATSUP</a>
<span>&bull;</span>
SealScript Theme by <a href="http://shellex.info">Shellex</a>
<span>&bull;</span>
Hosted on <a href="https://whmcs.hangssh.info/aff.php?aff=144">Host700</a>
<span>&bull;</span>
<a target="_blank" href="http://sighttp.qq.com/authd?IDKEY=cf54edfcbb086c98745cfe1a9eb2d7a8b8249f1c48135f26"><img border="0" src="http://wpa.qq.com/imgd?IDKEY=cf54edfcbb086c98745cfe1a9eb2d7a8b8249f1c48135f26&pic=45" alt="点击这里给我发消息" title="点击这里给我发消息"></a>
</div>
</div>
</div>
</div>
</body>
</html>
